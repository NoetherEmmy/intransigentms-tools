/* Author: Emmy Noether of IntransigentMS (intransigentms.com) */
var Dialogue=function(){var a=function(a,b){return function(){var c=a,d=b,e=a,f=[],g="",h=function(a){function b(){return d.callback&&d.callback(),d.nodispose||cm.dispose(),g}var h;if(void 0!==a){if(a==-1)if("continue"==d.endchat)a=0;else if("back"==d.endchat)a=-3;else{if("stay"!=d.endchat)return b();a=-1}if(0===f.length&&a<-1)return b();if(a>=0){if(!e.choices[a])return b();e=e.choices[a][1],f.push(a)}else if(a!=-1){for(h=-2;h>a;--h)if(void 0===f.pop())return b();for(e=c,h=0;h<f.length;++h)e=e.choices[f[h]][1]}}if(!e||!e.prompt)return b();if(g=e.prompt,!e.choices)return cm.sendOk(g),b();var i=g+"\r\n\r\n",j=e.choices;for(h=0;h<j.length;++h){var k=j[h];i+=void 0!==k[1].move?"#L"+(k[1].move>0?h:0==k[1].move?-1:k[1].move-2)+"#"+k[0]+"#l\r\n":"#L"+h+"#"+(Array.isArray(k)?k[0]:k)+"#l\r\n"}cm.sendSimple(i)},i=function(a){d.callback=a},j=function(a){d.endchat=a},k=function(a){d.nodispose=a},l=function(){c=d=e=f=g=void 0,delete this.setCallback,delete this.setEndChat,delete this.setNoDispose,delete this.talk,delete this.unload};return{talk:h,setCallback:i,setEndChat:j,setNoDispose:k,unload:l}}()};return{load:a}}();